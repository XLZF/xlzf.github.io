<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>T4模板应用 | Harris Blog</title><meta name="keywords" content="T4"><meta name="author" content="Harris"><meta name="copyright" content="Harris"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="记录T4模板的应用">
<meta property="og:type" content="article">
<meta property="og:title" content="T4模板应用">
<meta property="og:url" content="http://example.com/2021/11/26/T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8/index.html">
<meta property="og:site_name" content="Harris Blog">
<meta property="og:description" content="记录T4模板的应用">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2021-11-26T07:50:06.000Z">
<meta property="article:modified_time" content="2022-03-31T01:47:44.875Z">
<meta property="article:author" content="Harris">
<meta property="article:tag" content="T4">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/11/26/T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'T4模板应用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-31 09:47:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Harris Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">49</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">33</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Harris Blog</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">T4模板应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-11-26T07:50:06.000Z" title="Created 2021-11-26 15:50:06">2021-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-03-31T01:47:44.875Z" title="Updated 2022-03-31 09:47:44">2022-03-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C#</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="T4模板应用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="T4模板应用（一）"><a href="#T4模板应用（一）" class="headerlink" title="T4模板应用（一）"></a><code>T4</code>模板应用（一）</h1><p>之前在搭建系统框架的过程中用到的功能点，功效就是模板的功能。</p>
<p>个人是用<code>T4</code>模板批量生产到系统中的<code>CRUD</code>中，现在记录一下，不记录具体基础语法，只记录大概过程。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><h3 id="ModelAuto-ttinclude"><a href="#ModelAuto-ttinclude" class="headerlink" title="ModelAuto.ttinclude"></a><code>ModelAuto.ttinclude</code></h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="meta">#@ assembly name=&quot;System.Core&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;EnvDTE&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Collections.Generic&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.IO&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Text&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;Microsoft.VisualStudio.TextTemplating&quot;#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Manager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> Block &#123;</span><br><span class="line">        <span class="keyword">public</span> String Name;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Start, Length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Block&gt; blocks = <span class="keyword">new</span> List&lt;Block&gt;();</span><br><span class="line">    <span class="keyword">public</span> Block currentBlock;</span><br><span class="line">    <span class="keyword">public</span> Block footerBlock = <span class="keyword">new</span> Block();</span><br><span class="line">    <span class="keyword">public</span> Block headerBlock = <span class="keyword">new</span> Block();</span><br><span class="line">    <span class="keyword">public</span> ITextTemplatingEngineHost host;</span><br><span class="line">    <span class="keyword">public</span> ManagementStrategy strategy;</span><br><span class="line">    <span class="keyword">public</span> StringBuilder template;</span><br><span class="line">    <span class="keyword">public</span> String OutputPath &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Manager</span>(<span class="params">ITextTemplatingEngineHost host, StringBuilder template, <span class="built_in">bool</span> commonHeader</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">        <span class="keyword">this</span>.template = template;</span><br><span class="line">        OutputPath = String.Empty;</span><br><span class="line">        strategy = ManagementStrategy.Create(host);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartBlock</span>(<span class="params">String name</span>)</span> &#123;</span><br><span class="line">        currentBlock = <span class="keyword">new</span> Block &#123; Name = name, Start = template.Length &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartFooter</span>()</span> &#123;</span><br><span class="line">        footerBlock.Start = template.Length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndFooter</span>()</span> &#123;</span><br><span class="line">        footerBlock.Length = template.Length - footerBlock.Start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartHeader</span>()</span> &#123;</span><br><span class="line">        headerBlock.Start = template.Length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndHeader</span>()</span> &#123;</span><br><span class="line">        headerBlock.Length = template.Length - headerBlock.Start;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndBlock</span>()</span> &#123;</span><br><span class="line">        currentBlock.Length = template.Length - currentBlock.Start;</span><br><span class="line">        blocks.Add(currentBlock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Process</span>(<span class="params"><span class="built_in">bool</span> split</span>)</span> &#123;</span><br><span class="line">        String header = template.ToString(headerBlock.Start, headerBlock.Length);</span><br><span class="line">        String footer = template.ToString(footerBlock.Start, footerBlock.Length);</span><br><span class="line">        blocks.Reverse();</span><br><span class="line">        <span class="keyword">foreach</span>(Block block <span class="keyword">in</span> blocks) &#123;</span><br><span class="line">            String fileName = Path.Combine(OutputPath, block.Name);</span><br><span class="line">            <span class="keyword">if</span> (split) &#123;</span><br><span class="line">                String content = header + template.ToString(block.Start, block.Length) + footer;</span><br><span class="line">                strategy.CreateFile(fileName, content);</span><br><span class="line">                template.Remove(block.Start, block.Length);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                strategy.DeleteFile(fileName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">ManagementStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> ManagementStrategy <span class="title">Create</span>(<span class="params">ITextTemplatingEngineHost host</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (host <span class="keyword">is</span> IServiceProvider) ? <span class="keyword">new</span> VSManagementStrategy(host) : <span class="keyword">new</span> ManagementStrategy(host);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="title">ManagementStrategy</span>(<span class="params">ITextTemplatingEngineHost host</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CreateFile</span>(<span class="params">String fileName, String content</span>)</span> &#123;</span><br><span class="line">        File.WriteAllText(fileName, content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DeleteFile</span>(<span class="params">String fileName</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (File.Exists(fileName))</span><br><span class="line">            File.Delete(fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">VSManagementStrategy</span> : <span class="title">ManagementStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> EnvDTE.ProjectItem templateProjectItem;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="title">VSManagementStrategy</span>(<span class="params">ITextTemplatingEngineHost host</span>) : <span class="title">base</span>(<span class="params">host</span>)</span> &#123;</span><br><span class="line">        IServiceProvider hostServiceProvider = (IServiceProvider)host;</span><br><span class="line">        <span class="keyword">if</span> (hostServiceProvider == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;Could not obtain hostServiceProvider&quot;</span>);</span><br><span class="line"></span><br><span class="line">        EnvDTE.DTE dte = (EnvDTE.DTE)hostServiceProvider.GetService(<span class="keyword">typeof</span>(EnvDTE.DTE));</span><br><span class="line">        <span class="keyword">if</span> (dte == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;Could not obtain DTE from host&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateProjectItem = dte.Solution.FindProjectItem(host.TemplateFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">CreateFile</span>(<span class="params">String fileName, String content</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.CreateFile(fileName, content);</span><br><span class="line">        ((EventHandler)<span class="built_in">delegate</span> &#123; templateProjectItem.ProjectItems.AddFromFile(fileName); &#125;).BeginInvoke(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DeleteFile</span>(<span class="params">String fileName</span>)</span> &#123;</span><br><span class="line">        ((EventHandler)<span class="built_in">delegate</span> &#123; FindAndDeleteFile(fileName); &#125;).BeginInvoke(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindAndDeleteFile</span>(<span class="params">String fileName</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span>(EnvDTE.ProjectItem projectItem <span class="keyword">in</span> templateProjectItem.ProjectItems) &#123;</span><br><span class="line">            <span class="keyword">if</span> (projectItem.get_FileNames(<span class="number">0</span>) == fileName) &#123;</span><br><span class="line">                projectItem.Delete();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="meta">#&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="AllModelTemplate-tt"><a href="#AllModelTemplate-tt" class="headerlink" title="AllModelTemplate.tt"></a><code>AllModelTemplate.tt</code></h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="meta">#@ template debug=&quot;true&quot; hostspecific=&quot;true&quot; language=&quot;C#&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ output extension=&quot;.cs&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;System.Data&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;$(TargetDir)Oracle.ManagedDataAccess.dll&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;System.Xml&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Xml&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Data&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;Oracle.ManagedDataAccess&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Collections.Generic&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ include file=&quot;ModelAuto.ttinclude&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta"># var manager2 = new Manager(Host, GenerationEnvironment, true) &#123; OutputPath = Path.GetDirectoryName(Host.TemplateFile)&#125;; #&gt;</span></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">ModelManager manager = <span class="keyword">new</span> ModelManager();</span><br><span class="line">List&lt;<span class="built_in">string</span>&gt; list=manager.GetTableList();</span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> list)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">string</span> tableName=item;</span><br><span class="line">        DataTable table= manager.GetTableSchema(tableName);</span><br><span class="line"> <span class="meta">#&gt;</span></span><br><span class="line"></span><br><span class="line"> &lt;<span class="meta"># </span></span><br><span class="line">		manager2.StartBlock(tableName+<span class="string">&quot;.cs&quot;</span>);</span><br><span class="line"> <span class="meta">#&gt;</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Model</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 数据表实体类：<span class="doctag">&lt;#= tableName #&gt;</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Serializable()</span>]</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">class</span> &lt;#= <span class="title">tableName</span> #&gt;</span><br><span class="line">	&#123;</span><br><span class="line">&lt;<span class="meta">#</span></span><br><span class="line"><span class="keyword">foreach</span>(DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line">	   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;#=row[&quot;备注&quot;]#&gt;</span></span></span><br><span class="line">	   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span>     </span></span><br><span class="line">	   <span class="keyword">public</span> &lt;<span class="meta">#= manager.TransFromSqlType(row[&quot;数据类型&quot;].ToString())#&gt; &lt;#=row[&quot;字段名&quot;]#&gt;&#123; get; set; &#125;</span></span><br><span class="line">&lt;<span class="meta">#&#125;</span></span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="meta"># manager2.EndBlock(); #&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#</span></span><br><span class="line">    &#125;  </span><br><span class="line"> <span class="meta">#&gt;	 </span></span><br><span class="line">   </span><br><span class="line">&lt;<span class="meta"># manager2.Process(true); #&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#+</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModelManager</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 数据库连接字符串</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> CONNECTION_STRING = <span class="string">&quot;User ID=XLZF;Password=XLZF;Data Source=127.0.0.1/XE;&quot;</span>;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用户信息表名</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> PERSONINFO_TABLE_NAME = <span class="string">&quot;XLZF_USERS&quot;</span>;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据表名查询表结构信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> SELECT_SCHEMA_BY_TABLE_NAME = <span class="string">@&quot;SELECT A.column_name    字段名,                                                                                     A.data_type      数据类型,</span></span><br><span class="line"><span class="string">                                                                    A.data_length    长度,</span></span><br><span class="line"><span class="string">                                                                    A.data_precision 整数位,</span></span><br><span class="line"><span class="string">                                                                    A.Data_Scale     小数位,</span></span><br><span class="line"><span class="string">                                                                    A.nullable       允许空值,</span></span><br><span class="line"><span class="string">                                                                    A.Data_default   缺省值,</span></span><br><span class="line"><span class="string">                                                                    B.comments       备注,</span></span><br><span class="line"><span class="string">                                                                    A.TABLE_NAME     表名</span></span><br><span class="line"><span class="string">                                                                    FROM user_tab_columns A,user_col_comments B  </span></span><br><span class="line"><span class="string">                                                                    WHERE a.COLUMN_NAME = b.column_name</span></span><br><span class="line"><span class="string">                                                                    AND A.Table_Name = B.Table_Name</span></span><br><span class="line"><span class="string">                                                                    AND A.Table_Name = &#x27;&#123;0&#125;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得数据连接</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> Oracle.ManagedDataAccess.Client.<span class="function">OracleConnection <span class="title">GetConnection</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(CONNECTION_STRING);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 得到当前用户的所有表名</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; <span class="title">GetTableList</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> sql = <span class="string">&quot;SELECT * FROM USER_TABLES&quot;</span>;</span><br><span class="line">            DataTable dt = OracleHelper.ExecuteDataTable(sql);</span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">            <span class="keyword">if</span> (dt!=<span class="literal">null</span>&amp;&amp;dt.Rows.Count&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dt.Rows.Count; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    list.Add(dt.Rows[i][<span class="string">&quot;TABLE_NAME&quot;</span>].ToString());</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 释放连接</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;con&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ReleaseConnection</span>(<span class="params">Oracle.ManagedDataAccess.Client.OracleConnection con</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (con != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (con.State == ConnectionState.Open)</span><br><span class="line">                &#123;</span><br><span class="line">                    con.Close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取表内字段及字段其他信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;tableName&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataTable <span class="title">GetTableSchema</span>(<span class="params"><span class="built_in">string</span> tableName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            DataTable dt;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection con = GetConnection())</span><br><span class="line">            &#123;</span><br><span class="line">                con.Open();</span><br><span class="line"></span><br><span class="line">                Oracle.ManagedDataAccess.Client.OracleCommand cmd = con.CreateCommand();</span><br><span class="line"></span><br><span class="line">                cmd.CommandText = <span class="built_in">string</span>.Format(SELECT_SCHEMA_BY_TABLE_NAME,tableName);</span><br><span class="line"></span><br><span class="line">                cmd.CommandType = CommandType.Text;</span><br><span class="line"></span><br><span class="line">                Oracle.ManagedDataAccess.Client.OracleDataAdapter adapter = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleDataAdapter(cmd);</span><br><span class="line"></span><br><span class="line">                DataSet ds = <span class="keyword">new</span> DataSet(); </span><br><span class="line"></span><br><span class="line">                adapter.Fill(ds);</span><br><span class="line"></span><br><span class="line">                dt = ds.Tables[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> dt;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> SQL</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">TransFromSqlType</span>(<span class="params"><span class="built_in">string</span> type</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(type))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">string</span>.Empty;</span><br><span class="line">            &#125;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.Equals(type, <span class="string">&quot;number&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;int&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">string</span>.Equals(type, <span class="string">&quot;date&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;DateTime&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">string</span>.Equals(type, <span class="string">&quot;nvarchar2&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#+ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OracleHelper</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> oracleConnectionStr = <span class="string">&quot;User ID=XLZF;Password=XLZF;Data Source=127.0.0.1/XE;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataTable <span class="title">ExecuteDataTable</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> Oracle.ManagedDataAccess.Client.OracleParameter[] paramList</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection conn = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(oracleConnectionStr))</span><br><span class="line">            &#123; </span><br><span class="line">                conn.Open();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleCommand command = conn.CreateCommand())</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line"></span><br><span class="line">                    command.Parameters.AddRange(paramList);</span><br><span class="line"></span><br><span class="line">                    DataTable dt = <span class="keyword">new</span> DataTable();</span><br><span class="line"></span><br><span class="line">                    Oracle.ManagedDataAccess.Client.OracleDataAdapter adapter = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleDataAdapter(command);</span><br><span class="line"></span><br><span class="line">                    adapter.Fill(dt);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> dt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> Oracle.ManagedDataAccess.Client.OracleParameter[] paramList</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection conn = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(oracleConnectionStr))</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleCommand command = conn.CreateCommand())</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line">                    command.Parameters.AddRange(paramList);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> command.ExecuteNonQuery();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> Oracle.ManagedDataAccess.Client.OracleParameter[] paramList</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection conn = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(oracleConnectionStr))</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleCommand command = conn.CreateCommand())</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line">                    command.Parameters.AddRange(paramList);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> command.ExecuteScalar();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="meta">#&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>右键运行T4模板</p>
<p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205210438.png" alt="image-20211205210429402"></p>
<p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205210454.png" alt="image-20211205210452146"></p>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205210522.png" alt="image-20211205210516763"></p>
<p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205210544.png" alt="image-20211205210543104"></p>
<h1 id="T4模板应用（二）"><a href="#T4模板应用（二）" class="headerlink" title="T4模板应用（二）"></a><code>T4</code>模板应用（二）</h1><p>这次是通过 <code>MMSQL</code> 然后运行 <code>T4</code> 模板，生产数据库中所有表对应的实体类</p>
<h2 id="前提-1"><a href="#前提-1" class="headerlink" title="前提"></a>前提</h2><p><code>ModelAuto.ttinclude</code> 与前面的一致。</p>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p><code>ModelTemplate.tt</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="meta">#@ template language=&quot;C#&quot; debug=&quot;True&quot; hostspecific=&quot;True&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ output extension=&quot;.cs&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;System.Data&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;System.xml&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Collections.Generic&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Data.SqlClient&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Data&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ include file=&quot;ModelAuto.ttinclude&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta"># var manager = new Manager(Host, GenerationEnvironment, true) &#123; OutputPath = Path.GetDirectoryName(Host.TemplateFile)&#125;; #&gt;</span></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">	<span class="built_in">string</span> connectionString = <span class="string">&quot;Data Source=.;Initial Catalog=XLZF_TESTDB;User ID=sa;Password=MyMMSQL1433...;&quot;</span>; </span><br><span class="line">    SqlConnection conn = <span class="keyword">new</span> SqlConnection(connectionString); </span><br><span class="line">    conn.Open(); </span><br><span class="line">    System.Data.DataTable schema = conn.GetSchema(<span class="string">&quot;TABLES&quot;</span>); </span><br><span class="line">    <span class="built_in">string</span> selectQuery = <span class="string">&quot;select * from @tableName&quot;</span>; </span><br><span class="line">    SqlCommand command = <span class="keyword">new</span> SqlCommand(selectQuery,conn); </span><br><span class="line">    SqlDataAdapter ad = <span class="keyword">new</span> SqlDataAdapter(command); </span><br><span class="line">    System.Data.DataSet ds = <span class="keyword">new</span> DataSet();</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">string</span> propQuery = <span class="string">&quot;SELECT 表名=sobj.name,字段名=scol.name,字段说明=sprop.[value] FROM syscolumns as scol inner join sys.sysobjects as sobj on scol.id=sobj.id and sobj.xtype=&#x27;U&#x27; and sobj.name&lt;&gt;&#x27;dtproperties&#x27; left join sys.extended_properties as sprop on scol.id=sprop.major_id and scol.colid=sprop.minor_id where sobj.name=&#x27;@tableName&#x27; and scol.name=&#x27;@columnName&#x27;&quot;</span>; </span><br><span class="line">    SqlCommand command2 = <span class="keyword">new</span> SqlCommand(propQuery,conn); </span><br><span class="line">    SqlDataAdapter ad2 = <span class="keyword">new</span> SqlDataAdapter(command2); </span><br><span class="line">    System.Data.DataSet ds2 = <span class="keyword">new</span> DataSet();</span><br><span class="line"> <span class="meta">#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">    <span class="keyword">foreach</span>(System.Data.DataRow row <span class="keyword">in</span> schema.Rows) </span><br><span class="line">    &#123;  <span class="meta">#&gt;   </span></span><br><span class="line"></span><br><span class="line">     &lt;<span class="meta"># </span></span><br><span class="line">		manager.StartBlock(row[<span class="string">&quot;TABLE_NAME&quot;</span>]+<span class="string">&quot;.cs&quot;</span>);</span><br><span class="line">	 <span class="meta">#&gt;</span></span><br><span class="line">	<span class="comment">//----------&lt;#=row[&quot;TABLE_NAME&quot;].ToString()#&gt;开始----------</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">using</span> System;</span><br><span class="line">	<span class="keyword">namespace</span> <span class="title">MyProject.Entities</span> </span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 数据表实体类：<span class="doctag">&lt;#= row[&quot;TABLE_NAME&quot;].ToString() #&gt;</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">Serializable()</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> &lt;#= <span class="title">row</span>[&quot;<span class="title">TABLE_NAME</span>&quot;].<span class="title">ToString</span>() #&gt;</span><br><span class="line">        &#123;    </span><br><span class="line">		    &lt;<span class="meta">#</span></span><br><span class="line">            ds.Tables.Clear();</span><br><span class="line">            command.CommandText = selectQuery.Replace(<span class="string">&quot;@tableName&quot;</span>,row[<span class="string">&quot;TABLE_NAME&quot;</span>].ToString()); </span><br><span class="line">            ad.FillSchema(ds, SchemaType.Mapped, row[<span class="string">&quot;TABLE_NAME&quot;</span>].ToString());</span><br><span class="line">            <span class="keyword">foreach</span> (DataColumn dc <span class="keyword">in</span> ds.Tables[<span class="number">0</span>].Columns)</span><br><span class="line">            &#123; </span><br><span class="line">            <span class="meta">#&gt;</span></span><br><span class="line">            &lt;<span class="meta"># </span></span><br><span class="line">             ds2.Tables.Clear();</span><br><span class="line">             command2.CommandText = propQuery.Replace(<span class="string">&quot;@tableName&quot;</span>,row[<span class="string">&quot;TABLE_NAME&quot;</span>].ToString()); </span><br><span class="line">             command2.CommandText = command2.CommandText.Replace(<span class="string">&quot;@columnName&quot;</span>,dc.ColumnName); </span><br><span class="line">             ad2.Fill(ds2);</span><br><span class="line">            <span class="meta">#&gt; </span></span><br><span class="line">			<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">			<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;#= dc.DataType.Name #&gt;</span>:<span class="doctag">&lt;#=ds2.Tables[0].Rows[0].ItemArray[2]#&gt;</span></span></span><br><span class="line">			<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span>                       </span></span><br><span class="line">			<span class="keyword">public</span> &lt;<span class="meta">#= dc.DataType.Name #&gt; &lt;#= dc.ColumnName #&gt; &#123;get;set;&#125;   </span></span><br><span class="line">            &lt;<span class="meta"># &#125;  #&gt;   </span></span><br><span class="line">        &#125;    </span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//----------&lt;#=row[&quot;TABLE_NAME&quot;].ToString()#&gt;结束----------</span></span><br><span class="line"></span><br><span class="line">	&lt;<span class="meta"># manager.EndBlock(); #&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">    &#125; <span class="meta">#&gt; </span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#</span></span><br><span class="line">    manager.Process(<span class="literal">true</span>);</span><br><span class="line"><span class="meta">#&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h2><p>常规右键-运行自定义工具</p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205213046.png" alt="数据库表"></p>
<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205213126.png" alt="运行结果"></p>
<p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205213259.png" alt="image-20211205213257560"></p>
<p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205213412.png" alt="image-20211205213411337"></p>
<h1 id="T4模板应用（三）"><a href="#T4模板应用（三）" class="headerlink" title="T4模板应用（三）"></a><code>T4</code>模板应用（三）</h1><p>本节主要描述给<code>T4</code>模板传参，应用<code>T4</code>模板生产指定的程序。</p>
<p>由于涉及到传参，先定义一个</p>
<h2 id="参数实体"><a href="#参数实体" class="headerlink" title="参数实体"></a>参数实体</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ParameterEntity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 命名空间</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> NameSpace &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 作者</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Auth &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 表名</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> TableName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 连接字符串</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ConnectionString &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ModelAuto-ttinclude-1"><a href="#ModelAuto-ttinclude-1" class="headerlink" title="ModelAuto.ttinclude"></a><code>ModelAuto.ttinclude</code></h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="meta">#@ assembly name=&quot;System.Core&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;D:\2-技术实战\01-C#\04-Winform\DemoCode\packages\EnvDTE.8.0.2\lib\net10\EnvDTE.dll&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Collections.Generic&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.IO&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Text&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;Microsoft.VisualStudio.TextTemplating&quot;#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Manager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> Block &#123;</span><br><span class="line">        <span class="keyword">public</span> String Name;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Start, Length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Block&gt; blocks = <span class="keyword">new</span> List&lt;Block&gt;();</span><br><span class="line">    <span class="keyword">public</span> Block currentBlock;</span><br><span class="line">    <span class="keyword">public</span> Block footerBlock = <span class="keyword">new</span> Block();</span><br><span class="line">    <span class="keyword">public</span> Block headerBlock = <span class="keyword">new</span> Block();</span><br><span class="line">    <span class="keyword">public</span> ITextTemplatingEngineHost host;</span><br><span class="line">    <span class="keyword">public</span> ManagementStrategy strategy;</span><br><span class="line">    <span class="keyword">public</span> StringBuilder template;</span><br><span class="line">    <span class="keyword">public</span> String OutputPath &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Manager</span>(<span class="params">ITextTemplatingEngineHost host, StringBuilder template, <span class="built_in">bool</span> commonHeader</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">        <span class="keyword">this</span>.template = template;</span><br><span class="line">        OutputPath = String.Empty;</span><br><span class="line">        strategy = ManagementStrategy.Create(host);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartBlock</span>(<span class="params">String name</span>)</span> &#123;</span><br><span class="line">        currentBlock = <span class="keyword">new</span> Block &#123; Name = name, Start = template.Length &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartFooter</span>()</span> &#123;</span><br><span class="line">        footerBlock.Start = template.Length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndFooter</span>()</span> &#123;</span><br><span class="line">        footerBlock.Length = template.Length - footerBlock.Start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartHeader</span>()</span> &#123;</span><br><span class="line">        headerBlock.Start = template.Length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndHeader</span>()</span> &#123;</span><br><span class="line">        headerBlock.Length = template.Length - headerBlock.Start;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EndBlock</span>()</span> &#123;</span><br><span class="line">        currentBlock.Length = template.Length - currentBlock.Start;</span><br><span class="line">        blocks.Add(currentBlock);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Process</span>(<span class="params"><span class="built_in">bool</span> split</span>)</span> &#123;</span><br><span class="line">        String header = template.ToString(headerBlock.Start, headerBlock.Length);</span><br><span class="line">        String footer = template.ToString(footerBlock.Start, footerBlock.Length);</span><br><span class="line">        blocks.Reverse();</span><br><span class="line">        <span class="keyword">foreach</span>(Block block <span class="keyword">in</span> blocks) &#123;</span><br><span class="line">            String fileName = Path.Combine(OutputPath, block.Name);</span><br><span class="line">            <span class="keyword">if</span> (split) &#123;</span><br><span class="line">                String content = header + template.ToString(block.Start, block.Length) + footer;</span><br><span class="line">                strategy.CreateFile(fileName, content);</span><br><span class="line">                template.Remove(block.Start, block.Length);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                strategy.DeleteFile(fileName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">ManagementStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> ManagementStrategy <span class="title">Create</span>(<span class="params">ITextTemplatingEngineHost host</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (host <span class="keyword">is</span> IServiceProvider) ? <span class="keyword">new</span> VSManagementStrategy(host) : <span class="keyword">new</span> ManagementStrategy(host);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="title">ManagementStrategy</span>(<span class="params">ITextTemplatingEngineHost host</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CreateFile</span>(<span class="params">String fileName, String content</span>)</span> &#123;</span><br><span class="line">        File.WriteAllText(fileName, content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DeleteFile</span>(<span class="params">String fileName</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (File.Exists(fileName))</span><br><span class="line">            File.Delete(fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">VSManagementStrategy</span> : <span class="title">ManagementStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> EnvDTE.ProjectItem templateProjectItem;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="title">VSManagementStrategy</span>(<span class="params">ITextTemplatingEngineHost host</span>) : <span class="title">base</span>(<span class="params">host</span>)</span> &#123;</span><br><span class="line">        IServiceProvider hostServiceProvider = (IServiceProvider)host;</span><br><span class="line">        <span class="keyword">if</span> (hostServiceProvider == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;Could not obtain hostServiceProvider&quot;</span>);</span><br><span class="line"></span><br><span class="line">        EnvDTE.DTE dte = (EnvDTE.DTE)hostServiceProvider.GetService(<span class="keyword">typeof</span>(EnvDTE.DTE));</span><br><span class="line">        <span class="keyword">if</span> (dte == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;Could not obtain DTE from host&quot;</span>);</span><br><span class="line"></span><br><span class="line">        templateProjectItem = dte.Solution.FindProjectItem(host.TemplateFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">CreateFile</span>(<span class="params">String fileName, String content</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">base</span>.CreateFile(fileName, content);</span><br><span class="line">        ((EventHandler)<span class="built_in">delegate</span> &#123; templateProjectItem.ProjectItems.AddFromFile(fileName); &#125;).BeginInvoke(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DeleteFile</span>(<span class="params">String fileName</span>)</span> &#123;</span><br><span class="line">        ((EventHandler)<span class="built_in">delegate</span> &#123; FindAndDeleteFile(fileName); &#125;).BeginInvoke(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindAndDeleteFile</span>(<span class="params">String fileName</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">foreach</span>(EnvDTE.ProjectItem projectItem <span class="keyword">in</span> templateProjectItem.ProjectItems) &#123;</span><br><span class="line">            <span class="keyword">if</span> (projectItem.get_FileNames(<span class="number">0</span>) == fileName) &#123;</span><br><span class="line">                projectItem.Delete();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="meta">#&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="启动方法"><a href="#启动方法" class="headerlink" title="启动方法"></a>启动方法</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Mian_Two</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    ParameterEntity parameterEntity = <span class="keyword">new</span> ParameterEntity();</span><br><span class="line"></span><br><span class="line">    parameterEntity.Auth = <span class="string">&quot;MR.XLZF&quot;</span>;</span><br><span class="line"></span><br><span class="line">    parameterEntity.ConnectionString = <span class="string">&quot;User ID=XLZF;Password=XLZF;Data Source=127.0.0.1/XLZF;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    parameterEntity.NameSpace = <span class="string">&quot;T4ParameterSample&quot;</span>;</span><br><span class="line"></span><br><span class="line">    parameterEntity.TableName = <span class="string">&quot;CONFIGTABLE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> T4File = <span class="string">&quot;AllModelTemplate_1.tt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> templateFileName = Path.GetFullPath(T4File);</span><br><span class="line"></span><br><span class="line">    CustomTextTemplatingEngineHost host = <span class="keyword">new</span> CustomTextTemplatingEngineHost();</span><br><span class="line"></span><br><span class="line">    Engine engine = <span class="keyword">new</span> Engine();</span><br><span class="line"></span><br><span class="line">    host.TemplateFileValue = templateFileName;</span><br><span class="line"></span><br><span class="line">    host.Session = <span class="keyword">new</span> TextTemplatingSession();</span><br><span class="line"></span><br><span class="line">    host.Session.Add(<span class="string">&quot;parameter1&quot;</span>, parameterEntity);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> input = File.ReadAllText(templateFileName);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> output = engine.ProcessTemplate(input, host);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(output);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (CompilerError error <span class="keyword">in</span> host.Errors)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(error.ToString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Console.ReadLine();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CustomTextTemplatingEngineHost-cs"><a href="#CustomTextTemplatingEngineHost-cs" class="headerlink" title="CustomTextTemplatingEngineHost.cs"></a><code>CustomTextTemplatingEngineHost.cs</code></h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.CodeDom.Compiler;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> Microsoft.VisualStudio.TextTemplating;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">T4ParameterSample</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomTextTemplatingEngineHost</span> : <span class="title">ITextTemplatingEngineHost</span>, <span class="title">ITextTemplatingSessionHost</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> ITextTemplatingEngineHost</span></span><br><span class="line">        <span class="comment">//the path and file name of the text template that is being processed</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="keyword">internal</span> <span class="built_in">string</span> TemplateFileValue;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> TemplateFile</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> TemplateFileValue; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//This will be the extension of the generated text output file.</span></span><br><span class="line">        <span class="comment">//The host can provide a default by setting the value of the field here.</span></span><br><span class="line">        <span class="comment">//The engine can change this value based on the optional output directive</span></span><br><span class="line">        <span class="comment">//if the user specifies it in the text template.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> fileExtensionValue = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> FileExtension</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> fileExtensionValue; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//This will be the encoding of the generated text output file.</span></span><br><span class="line">        <span class="comment">//The host can provide a default by setting the value of the field here.</span></span><br><span class="line">        <span class="comment">//The engine can change this value based on the optional output directive</span></span><br><span class="line">        <span class="comment">//if the user specifies it in the text template.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="keyword">private</span> Encoding fileEncodingValue = Encoding.UTF8;</span><br><span class="line">        <span class="keyword">public</span> Encoding FileEncoding</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> fileEncodingValue; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//These are the errors that occur when the engine processes a template.</span></span><br><span class="line">        <span class="comment">//The engine passes the errors to the host when it is done processing,</span></span><br><span class="line">        <span class="comment">//and the host can decide how to display them. For example, the host </span></span><br><span class="line">        <span class="comment">//can display the errors in the UI or write them to a file.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="keyword">private</span> CompilerErrorCollection errorsValue;</span><br><span class="line">        <span class="keyword">public</span> CompilerErrorCollection Errors</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> errorsValue; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The host can provide standard assembly references.</span></span><br><span class="line">        <span class="comment">//The engine will use these references when compiling and</span></span><br><span class="line">        <span class="comment">//executing the generated transformation class.</span></span><br><span class="line">        <span class="comment">//--------------------------------------------------------------</span></span><br><span class="line">        <span class="keyword">public</span> IList&lt;<span class="built_in">string</span>&gt; StandardAssemblyReferences</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//If this host searches standard paths and the GAC,</span></span><br><span class="line">                    <span class="comment">//we can specify the assembly name like this.</span></span><br><span class="line">                    <span class="comment">//---------------------------------------------------------</span></span><br><span class="line">                    <span class="comment">//&quot;System&quot;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//Because this host only resolves assemblies from the </span></span><br><span class="line">                    <span class="comment">//fully qualified path and name of the assembly,</span></span><br><span class="line">                    <span class="comment">//this is a quick way to get the code to give us the</span></span><br><span class="line">                    <span class="comment">//fully qualified path and name of the System assembly.</span></span><br><span class="line">                    <span class="comment">//---------------------------------------------------------</span></span><br><span class="line">                    <span class="keyword">typeof</span>(System.Uri).Assembly.Location,</span><br><span class="line">                    <span class="keyword">typeof</span>(T4ParameterSample.Parameter).Assembly.Location</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The host can provide standard imports or using statements.</span></span><br><span class="line">        <span class="comment">//The engine will add these statements to the generated </span></span><br><span class="line">        <span class="comment">//transformation class.</span></span><br><span class="line">        <span class="comment">//--------------------------------------------------------------</span></span><br><span class="line">        <span class="keyword">public</span> IList&lt;<span class="built_in">string</span>&gt; StandardImports</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[]</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;System&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;T4ParameterSample&quot;</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The engine calls this method based on the optional include directive</span></span><br><span class="line">        <span class="comment">//if the user has specified it in the text template.</span></span><br><span class="line">        <span class="comment">//This method can be called 0, 1, or more times.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="comment">//The included text is returned in the context parameter.</span></span><br><span class="line">        <span class="comment">//If the host searches the registry for the location of include files,</span></span><br><span class="line">        <span class="comment">//or if the host searches multiple locations by default, the host can</span></span><br><span class="line">        <span class="comment">//return the final path of the include file in the location parameter.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">LoadIncludeText</span>(<span class="params"><span class="built_in">string</span> requestFileName, <span class="keyword">out</span> <span class="built_in">string</span> content, <span class="keyword">out</span> <span class="built_in">string</span> location</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            content = System.String.Empty;</span><br><span class="line">            location = System.String.Empty;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//If the argument is the fully qualified path of an existing file,</span></span><br><span class="line">            <span class="comment">//then we are done.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="keyword">if</span> (File.Exists(requestFileName))</span><br><span class="line">            &#123;</span><br><span class="line">                content = File.ReadAllText(requestFileName);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//This can be customized to search specific paths for the file.</span></span><br><span class="line">            <span class="comment">//This can be customized to accept paths to search as command line</span></span><br><span class="line">            <span class="comment">//arguments.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Called by the Engine to enquire about </span></span><br><span class="line">        <span class="comment">//the processing options you require. </span></span><br><span class="line">        <span class="comment">//If you recognize that option, return an </span></span><br><span class="line">        <span class="comment">//appropriate value. </span></span><br><span class="line">        <span class="comment">//Otherwise, pass back NULL.</span></span><br><span class="line">        <span class="comment">//--------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">GetHostOption</span>(<span class="params"><span class="built_in">string</span> optionName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">object</span> returnObject;</span><br><span class="line">            <span class="keyword">switch</span> (optionName)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;CacheAssemblies&quot;</span>:</span><br><span class="line">                    returnObject = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="literal">default</span>:</span><br><span class="line">                    returnObject = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> returnObject;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The engine calls this method to resolve assembly references used in</span></span><br><span class="line">        <span class="comment">//the generated transformation class project and for the optional </span></span><br><span class="line">        <span class="comment">//assembly directive if the user has specified it in the text template.</span></span><br><span class="line">        <span class="comment">//This method can be called 0, 1, or more times.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ResolveAssemblyReference</span>(<span class="params"><span class="built_in">string</span> assemblyReference</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//If the argument is the fully qualified path of an existing file,</span></span><br><span class="line">            <span class="comment">//then we are done. (This does not do any work.)</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="keyword">if</span> (File.Exists(assemblyReference))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> assemblyReference;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Maybe the assembly is in the same folder as the text template that </span></span><br><span class="line">            <span class="comment">//called the directive.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="built_in">string</span> candidate = Path.Combine(Path.GetDirectoryName(<span class="keyword">this</span>.TemplateFile), assemblyReference);</span><br><span class="line">            <span class="keyword">if</span> (File.Exists(candidate))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> candidate;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//This can be customized to search specific paths for the file</span></span><br><span class="line">            <span class="comment">//or to search the GAC.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="comment">//This can be customized to accept paths to search as command line</span></span><br><span class="line">            <span class="comment">//arguments.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="comment">//If we cannot do better, return the original file name.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The engine calls this method based on the directives the user has </span></span><br><span class="line">        <span class="comment">//specified in the text template.</span></span><br><span class="line">        <span class="comment">//This method can be called 0, 1, or more times.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Type <span class="title">ResolveDirectiveProcessor</span>(<span class="params"><span class="built_in">string</span> processorName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//This host will not resolve any specific processors.</span></span><br><span class="line">            <span class="comment">//Check the processor name, and if it is the name of a processor the </span></span><br><span class="line">            <span class="comment">//host wants to support, return the type of the processor.</span></span><br><span class="line">            <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.Compare(processorName, <span class="string">&quot;XYZ&quot;</span>, StringComparison.OrdinalIgnoreCase) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//return typeof();</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//This can be customized to search specific paths for the file</span></span><br><span class="line">            <span class="comment">//or to search the GAC</span></span><br><span class="line">            <span class="comment">//If the directive processor cannot be found, throw an error.</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Directive Processor not found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//A directive processor can call this method if a file name does not </span></span><br><span class="line">        <span class="comment">//have a path.</span></span><br><span class="line">        <span class="comment">//The host can attempt to provide path information by searching </span></span><br><span class="line">        <span class="comment">//specific paths for the file and returning the file and path if found.</span></span><br><span class="line">        <span class="comment">//This method can be called 0, 1, or more times.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ResolvePath</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileName == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;the file name cannot be null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//If the argument is the fully qualified path of an existing file,</span></span><br><span class="line">            <span class="comment">//then we are done</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="keyword">if</span> (File.Exists(fileName))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> fileName;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Maybe the file is in the same folder as the text template that </span></span><br><span class="line">            <span class="comment">//called the directive.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="built_in">string</span> candidate = Path.Combine(Path.GetDirectoryName(<span class="keyword">this</span>.TemplateFile), fileName);</span><br><span class="line">            <span class="keyword">if</span> (File.Exists(candidate))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> candidate;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Look more places.</span></span><br><span class="line">            <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">            <span class="comment">//More code can go here...</span></span><br><span class="line">            <span class="comment">//If we cannot do better, return the original file name.</span></span><br><span class="line">            <span class="keyword">return</span> fileName;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//If a call to a directive in a text template does not provide a value</span></span><br><span class="line">        <span class="comment">//for a required parameter, the directive processor can try to get it</span></span><br><span class="line">        <span class="comment">//from the host by calling this method.</span></span><br><span class="line">        <span class="comment">//This method can be called 0, 1, or more times.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ResolveParameterValue</span>(<span class="params"><span class="built_in">string</span> directiveId, <span class="built_in">string</span> processorName, <span class="built_in">string</span> parameterName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (directiveId == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;the directiveId cannot be null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (processorName == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;the processorName cannot be null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (parameterName == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;the parameterName cannot be null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Code to provide &quot;hard-coded&quot; parameter values goes here.</span></span><br><span class="line">            <span class="comment">//This code depends on the directive processors this host will interact with.</span></span><br><span class="line">            <span class="comment">//If we cannot do better, return the empty string.</span></span><br><span class="line">            <span class="keyword">return</span> String.Empty;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The engine calls this method to change the extension of the </span></span><br><span class="line">        <span class="comment">//generated text output file based on the optional output directive </span></span><br><span class="line">        <span class="comment">//if the user specifies it in the text template.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetFileExtension</span>(<span class="params"><span class="built_in">string</span> extension</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//The parameter extension has a &#x27;.&#x27; in front of it already.</span></span><br><span class="line">            <span class="comment">//--------------------------------------------------------</span></span><br><span class="line">            fileExtensionValue = extension;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The engine calls this method to change the encoding of the </span></span><br><span class="line">        <span class="comment">//generated text output file based on the optional output directive </span></span><br><span class="line">        <span class="comment">//if the user specifies it in the text template.</span></span><br><span class="line">        <span class="comment">//----------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetOutputEncoding</span>(<span class="params">System.Text.Encoding encoding, <span class="built_in">bool</span> fromOutputDirective</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            fileEncodingValue = encoding;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//The engine calls this method when it is done processing a text</span></span><br><span class="line">        <span class="comment">//template to pass any errors that occurred to the host.</span></span><br><span class="line">        <span class="comment">//The host can decide how to display them.</span></span><br><span class="line">        <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LogErrors</span>(<span class="params">CompilerErrorCollection errors</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            errorsValue = errors;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//This is the application domain that is used to compile and run</span></span><br><span class="line">        <span class="comment">//the generated transformation class to create the generated text output.</span></span><br><span class="line">        <span class="comment">//----------------------------------------------------------------------</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> AppDomain <span class="title">ProvideTemplatingAppDomain</span>(<span class="params"><span class="built_in">string</span> content</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//This host will provide a new application domain each time the </span></span><br><span class="line">            <span class="comment">//engine processes a text template.</span></span><br><span class="line">            <span class="comment">//-------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//return AppDomain.CurrentDomain;</span></span><br><span class="line">            <span class="keyword">return</span> AppDomain.CreateDomain(<span class="string">&quot;Generation App Domain&quot;</span>);</span><br><span class="line">            <span class="comment">//This could be changed to return the current appdomain, but new </span></span><br><span class="line">            <span class="comment">//assemblies are loaded into this AppDomain on a regular basis.</span></span><br><span class="line">            <span class="comment">//If the AppDomain lasts too long, it will grow indefintely, </span></span><br><span class="line">            <span class="comment">//which might be regarded as a leak.</span></span><br><span class="line">            <span class="comment">//This could be customized to cache the application domain for </span></span><br><span class="line">            <span class="comment">//a certain number of text template generations (for example, 10).</span></span><br><span class="line">            <span class="comment">//This could be customized based on the contents of the text </span></span><br><span class="line">            <span class="comment">//template, which are provided as a parameter for that purpose.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> ITextTemplatingSessionHost</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ITextTemplatingSession <span class="title">CreateSession</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Session;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ITextTemplatingSession Session</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AllModelTemplate-1-tt"><a href="#AllModelTemplate-1-tt" class="headerlink" title="AllModelTemplate_1.tt"></a><code>AllModelTemplate_1.tt</code></h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="meta">#@ template debug=&quot;true&quot; hostspecific=&quot;false&quot; language=&quot;C#&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ output extension=&quot;.txt&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.8\System.Data.dll&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.8\System.Data.OracleClient.dll&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.8\System.Xml.dll&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ assembly name=&quot;E:\Code\DemoCode\T4ParameterSample\bin\Debug\Oracle.ManagedDataAccess.dll&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Xml&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Data&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;Oracle.ManagedDataAccess&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ import namespace=&quot;System.Collections.Generic&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ include file=&quot;ModelAuto.ttinclude&quot;#&gt;</span></span><br><span class="line">&lt;<span class="meta">#@ parameter name=&quot;parameter1&quot; type=&quot;T4ParameterSample.ParameterEntity&quot; #&gt;</span></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">ModelManager manager = <span class="keyword">new</span> ModelManager();</span><br><span class="line">manager.CONNECTION_STRING = parameter1.ConnectionString;</span><br><span class="line">List&lt;<span class="built_in">string</span>&gt; list=manager.GetTableList(parameter1.TableName);</span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta"># </span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> list)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">string</span> tableName=item;</span><br><span class="line">        DataTable table= manager.GetTableSchema(tableName);</span><br><span class="line"> <span class="meta">#&gt;</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System.Data.OracleClient;</span><br><span class="line"><span class="keyword">namespace</span> &lt;#= parameter1.NameSpace <span class="meta">#&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 数据表实体类：<span class="doctag">&lt;#= tableName #&gt;</span> </span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> By: <span class="doctag">&lt;#= parameter1.Auth #&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Serializable()</span>]</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">class</span> &lt;#= <span class="title">tableName</span> #&gt;</span><br><span class="line">	&#123;</span><br><span class="line">&lt;<span class="meta">#</span></span><br><span class="line"><span class="keyword">foreach</span>(DataRow row <span class="keyword">in</span> table.Rows)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line">	   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;#=row[&quot;备注&quot;]#&gt;</span></span></span><br><span class="line">	   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span>     </span></span><br><span class="line">	   <span class="keyword">public</span> &lt;<span class="meta">#= manager.TransFromSqlType(row[&quot;数据类型&quot;].ToString())#&gt; &lt;#=row[&quot;字段名&quot;]#&gt;&#123; get; set; &#125;</span></span><br><span class="line">&lt;<span class="meta">#&#125;</span></span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#</span></span><br><span class="line">    &#125;  </span><br><span class="line"> <span class="meta">#&gt;	 </span></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#+</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModelManager</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 数据库连接字符串</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CONNECTION_STRING = <span class="string">&quot;User ID=XLZF;Password=XLZF;Data Source=127.0.0.1/XE;&quot;</span>;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用户信息表名</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> PERSONINFO_TABLE_NAME = <span class="string">&quot;XLZF_USERS&quot;</span>;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据表名查询表结构信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> SELECT_SCHEMA_BY_TABLE_NAME = <span class="string">@&quot;SELECT A.column_name    字段名,                                                                                     A.data_type      数据类型,</span></span><br><span class="line"><span class="string">                                                                    A.data_length    长度,</span></span><br><span class="line"><span class="string">                                                                    A.data_precision 整数位,</span></span><br><span class="line"><span class="string">                                                                    A.Data_Scale     小数位,</span></span><br><span class="line"><span class="string">                                                                    A.nullable       允许空值,</span></span><br><span class="line"><span class="string">                                                                    A.Data_default   缺省值,</span></span><br><span class="line"><span class="string">                                                                    B.comments       备注,</span></span><br><span class="line"><span class="string">                                                                    A.TABLE_NAME     表名</span></span><br><span class="line"><span class="string">                                                                    FROM user_tab_columns A,user_col_comments B  </span></span><br><span class="line"><span class="string">                                                                    WHERE a.COLUMN_NAME = b.column_name</span></span><br><span class="line"><span class="string">                                                                    AND A.Table_Name = B.Table_Name</span></span><br><span class="line"><span class="string">                                                                    AND A.Table_Name = &#x27;&#123;0&#125;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得数据连接</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> Oracle.ManagedDataAccess.Client.<span class="function">OracleConnection <span class="title">GetConnection</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(CONNECTION_STRING);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 得到当前用户的所有表名</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; <span class="title">GetTableList</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            OracleHelper helper = <span class="keyword">new</span> OracleHelper();</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">string</span> sql = <span class="string">&quot;SELECT * FROM USER_TABLES&quot;</span>;</span><br><span class="line"></span><br><span class="line">            DataTable dt = helper.ExecuteDataTable(sql);</span><br><span class="line"></span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dt!=<span class="literal">null</span>&amp;&amp;dt.Rows.Count&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dt.Rows.Count; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    list.Add(dt.Rows[i][<span class="string">&quot;TABLE_NAME&quot;</span>].ToString());</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">		 <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 得到当前用户的所有表名</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;<span class="built_in">string</span>&gt; <span class="title">GetTableList</span>(<span class="params"><span class="built_in">string</span> tableName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> sql = <span class="string">&quot;SELECT * FROM USER_TABLES WHERE TABLE_NAME = &#x27;&quot;</span>+tableName+<span class="string">&quot;&#x27; &quot;</span>;</span><br><span class="line"></span><br><span class="line">			OracleHelper helper = <span class="keyword">new</span> OracleHelper();</span><br><span class="line"></span><br><span class="line">			helper.oracleConnectionStr = CONNECTION_STRING;</span><br><span class="line">			</span><br><span class="line">            DataTable dt = helper.ExecuteDataTable(sql);</span><br><span class="line"></span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dt!=<span class="literal">null</span>&amp;&amp;dt.Rows.Count&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dt.Rows.Count; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    list.Add(dt.Rows[i][<span class="string">&quot;TABLE_NAME&quot;</span>].ToString());</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 释放连接</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;con&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReleaseConnection</span>(<span class="params">Oracle.ManagedDataAccess.Client.OracleConnection con</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (con != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (con.State == ConnectionState.Open)</span><br><span class="line">                &#123;</span><br><span class="line">                    con.Close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取表内字段及字段其他信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;tableName&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataTable <span class="title">GetTableSchema</span>(<span class="params"><span class="built_in">string</span> tableName</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            DataTable dt;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection con = GetConnection())</span><br><span class="line">            &#123;</span><br><span class="line">                con.Open();</span><br><span class="line"></span><br><span class="line">                Oracle.ManagedDataAccess.Client.OracleCommand cmd = con.CreateCommand();</span><br><span class="line"></span><br><span class="line">                cmd.CommandText = <span class="built_in">string</span>.Format(SELECT_SCHEMA_BY_TABLE_NAME,tableName);</span><br><span class="line"></span><br><span class="line">                cmd.CommandType = CommandType.Text;</span><br><span class="line"></span><br><span class="line">                Oracle.ManagedDataAccess.Client.OracleDataAdapter adapter = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleDataAdapter(cmd);</span><br><span class="line"></span><br><span class="line">                DataSet ds = <span class="keyword">new</span> DataSet(); </span><br><span class="line"></span><br><span class="line">                adapter.Fill(ds);</span><br><span class="line"></span><br><span class="line">                dt = ds.Tables[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> dt;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> SQL</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">TransFromSqlType</span>(<span class="params"><span class="built_in">string</span> type</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(type))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">string</span>.Empty;</span><br><span class="line">            &#125;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.Equals(type, <span class="string">&quot;number&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;int&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">string</span>.Equals(type, <span class="string">&quot;date&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;DateTime&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">string</span>.Equals(type, <span class="string">&quot;nvarchar2&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="meta">#+ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OracleHelper</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> oracleConnectionStr = <span class="string">&quot;User ID=XLZF;Password=XLZF;Data Source=127.0.0.1/XLZF;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataTable <span class="title">ExecuteDataTable</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> Oracle.ManagedDataAccess.Client.OracleParameter[] paramList</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection conn = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(oracleConnectionStr))</span><br><span class="line">            &#123; </span><br><span class="line">                conn.Open();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleCommand command = conn.CreateCommand())</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line"></span><br><span class="line">                    command.Parameters.AddRange(paramList);</span><br><span class="line"></span><br><span class="line">                    DataTable dt = <span class="keyword">new</span> DataTable();</span><br><span class="line"></span><br><span class="line">                    Oracle.ManagedDataAccess.Client.OracleDataAdapter adapter = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleDataAdapter(command);</span><br><span class="line"></span><br><span class="line">                    adapter.Fill(dt);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> dt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> Oracle.ManagedDataAccess.Client.OracleParameter[] paramList</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection conn = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(oracleConnectionStr))</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleCommand command = conn.CreateCommand())</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line">                    command.Parameters.AddRange(paramList);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> command.ExecuteNonQuery();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> Oracle.ManagedDataAccess.Client.OracleParameter[] paramList</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleConnection conn = <span class="keyword">new</span> Oracle.ManagedDataAccess.Client.OracleConnection(oracleConnectionStr))</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                <span class="keyword">using</span> (Oracle.ManagedDataAccess.Client.OracleCommand command = conn.CreateCommand())</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line">                    command.Parameters.AddRange(paramList);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> command.ExecuteScalar();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="meta">#&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h2><p><img src="https://blogimage-1255495010.cos.ap-beijing.myqcloud.com/20211205223647.png" alt="image-20211205223643141"></p>
<p>结合传参功能的实现，在结合多种数据库，可以实现多种批量生产代码的功能，后续补充个人工具中的应用。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://example.com">Harris</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/11/26/T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8/">http://example.com/2021/11/26/T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/T4/">T4</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/28/Docker-for-Oracle-11g/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Docker for Oracle_11g</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/19/Git_Cmd/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Git 常用命令及坑记录</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Harris</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">49</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">33</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">T4模板应用（一）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90"><span class="toc-number">1.1.</span> <span class="toc-text">前提</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ModelAuto-ttinclude"><span class="toc-number">1.1.1.</span> <span class="toc-text">ModelAuto.ttinclude</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AllModelTemplate-tt"><span class="toc-number">1.1.2.</span> <span class="toc-text">AllModelTemplate.tt</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">1.2.</span> <span class="toc-text">运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">1.3.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">T4模板应用（二）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90-1"><span class="toc-number">2.1.</span> <span class="toc-text">前提</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-1"><span class="toc-number">2.3.</span> <span class="toc-text">运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.4.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">2.5.</span> <span class="toc-text">运行结果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#T4%E6%A8%A1%E6%9D%BF%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%89%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">T4模板应用（三）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%AE%9E%E4%BD%93"><span class="toc-number">3.1.</span> <span class="toc-text">参数实体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ModelAuto-ttinclude-1"><span class="toc-number">3.2.</span> <span class="toc-text">ModelAuto.ttinclude</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.</span> <span class="toc-text">启动方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CustomTextTemplatingEngineHost-cs"><span class="toc-number">3.4.</span> <span class="toc-text">CustomTextTemplatingEngineHost.cs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AllModelTemplate-1-tt"><span class="toc-number">3.5.</span> <span class="toc-text">AllModelTemplate_1.tt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C-1"><span class="toc-number">3.6.</span> <span class="toc-text">结果</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/09/wireshark-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/" title="Wireshark-三次握手四次挥手"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Wireshark-三次握手四次挥手"/></a><div class="content"><a class="title" href="/2022/05/09/wireshark-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/" title="Wireshark-三次握手四次挥手">Wireshark-三次握手四次挥手</a><time datetime="2022-05-09T08:27:02.000Z" title="Created 2022-05-09 16:27:02">2022-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/07/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="面试题"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试题"/></a><div class="content"><a class="title" href="/2022/05/07/%E9%9D%A2%E8%AF%95%E9%A2%98/" title="面试题">面试题</a><time datetime="2022-05-07T13:57:08.000Z" title="Created 2022-05-07 21:57:08">2022-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/06/CSharp-%E5%85%B3%E9%94%AE%E5%AD%97/" title="CSharp-关键字"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSharp-关键字"/></a><div class="content"><a class="title" href="/2022/05/06/CSharp-%E5%85%B3%E9%94%AE%E5%AD%97/" title="CSharp-关键字">CSharp-关键字</a><time datetime="2022-05-06T01:17:14.000Z" title="Created 2022-05-06 09:17:14">2022-05-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="设计模式-代理模式"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式-代理模式"/></a><div class="content"><a class="title" href="/2022/05/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="设计模式-代理模式">设计模式-代理模式</a><time datetime="2022-05-05T09:38:11.000Z" title="Created 2022-05-05 17:38:11">2022-05-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/" title="设计模式-享元模式"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式-享元模式"/></a><div class="content"><a class="title" href="/2022/05/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/" title="设计模式-享元模式">设计模式-享元模式</a><time datetime="2022-05-05T07:45:16.000Z" title="Created 2022-05-05 15:45:16">2022-05-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Harris</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>